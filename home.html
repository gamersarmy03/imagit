<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Imagit - Premium Image Upload Platform</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@appwrite.io/sdk@13.0.1/dist/index.umd.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Appwrite Configuration
    const client = new window.Appwrite.Client()
      .setEndpoint('https://cloud.appwrite.io/v1')
      .setProject('imagit112233');
    const databases = new window.Appwrite.Databases(client);

    // Internet Archive S3 Configuration
    const IA_ACCESS_KEY = 'jBR7XOg62J8mIUEg';
    const IA_SECRET_KEY = 'pPzeXleaI98sZLhe';
    const IA_BUCKET = 'imagit-uploads';

    const App = () => {
      const [images, setImages] = useState([]);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [selectedFiles, setSelectedFiles] = useState([]);
      const [title, setTitle] = useState('');
      const [uploading, setUploading] = useState(false);

      // Fetch images from Appwrite
      useEffect(() => {
        const fetchImages = async () => {
          try {
            const response = await databases.listDocuments('uploads1122', 'uploads112233');
            setImages(response.documents);
          } catch (error) {
            console.error('Error fetching images:', error);
          }
        };
        fetchImages();
      }, []);

      // Handle file selection
      const handleFileChange = (e) => {
        setSelectedFiles([...e.target.files]);
      };

      // Upload images to Internet Archive and save metadata to Appwrite
      const handleUpload = async () => {
        if (!title || selectedFiles.length === 0) {
          alert('Please provide a title and select at least one image.');
          return;
        }

        setUploading(true);
        try {
          for (const file of selectedFiles) {
            // Generate unique identifier
            const identifier = `imagit-${Date.now()}-${file.name.replace(/\s+/g, '-')}`;
            const url = `https://archive.org/download/${identifier}/${file.name}`;

            // Upload to Internet Archive using S3-like API
            const formData = new FormData();
            formData.append('file', file);
            await axios.put(`https://s3.us.archive.org/${identifier}/${file.name}`, formData, {
              headers: {
                Authorization: `LOW ${IA_ACCESS_KEY}:${IA_SECRET_KEY}`,
                'Content-Type': 'multipart/form-data',
                'x-amz-auto-make-bucket': '1',
                'x-archive-meta-title': title,
                'x-archive-meta-mediatype': 'image',
              },
            });

            // Save metadata to Appwrite
            await databases.createDocument(
              'uploads1122',
              'uploads112233',
              window.Appwrite.ID.unique(),
              {
                title,
                identifier,
                url,
                mediaType: 'image',
                createdAt: new Date().toISOString(),
              }
            );
          }

          // Refresh image list
          const response = await databases.listDocuments('uploads1122', 'uploads112233');
          setImages(response.documents);
          setIsModalOpen(false);
          setTitle('');
          setSelectedFiles([]);
        } catch (error) {
          console.error('Error uploading:', error);
          alert('Upload failed. Please try again.');
        } finally {
          setUploading(false);
        }
      };

      return (
        <div className="min-h-screen bg-gray-900">
          {/* Header */}
          <header className="bg-gray-800 shadow-lg py-4">
            <div className="max-w-7xl mx-auto px-4 flex justify-between items-center">
              <h1 className="text-3xl font-bold text-amber-400">Imagit</h1>
              <button
                onClick={() => setIsModalOpen(true)}
                className="bg-amber-500 text-gray-900 px-4 py-2 rounded-md hover:bg-amber-400 transition"
              >
                Upload
              </button>
            </div>
          </header>

          {/* Main Content */}
          <main className="max-w-7xl mx-auto px-4 py-8">
            <h2 className="text-2xl font-semibold mb-6">Uploaded Images</h2>
            <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
              {images.map((image) => (
                <div
                  key={image.$id}
                  className="bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1"
                >
                  <img
                    src={image.url}
                    alt={image.title}
                    className="w-full h-48 object-cover"
                  />
                  <div className="p-4">
                    <h3 className="text-lg font-medium text-amber-400">{image.title}</h3>
                    <p className="text-sm text-gray-400">{new Date(image.createdAt).toLocaleDateString()}</p>
                  </div>
                </div>
              ))}
            </div>
          </main>

          {/* Upload Modal */}
          {isModalOpen && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
              <div className="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-md">
                <h2 className="text-xl font-semibold mb-4 text-amber-400">Upload Images</h2>
                <input
                  type="text"
                  placeholder="Enter title"
                  value={title}
                  onChange={(e) => setTitle(e.target.value)}
                  className="w-full p-2 mb-4 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-amber-400"
                />
                <input
                  type="file"
                  multiple
                  accept="image/*"
                  onChange={handleFileChange}
                  className="w-full p-2 mb-4 bg-gray-700 text-white rounded-md"
                />
                <div className="flex justify-end space-x-2">
                  <button
                    onClick={() => setIsModalOpen(false)}
                    className="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-500 transition"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handleUpload}
                    disabled={uploading}
                    className={`bg-amber-500 text-gray-900 px-4 py-2 rounded-md hover:bg-amber-400 transition ${
                      uploading ? 'opacity-50 cursor-not-allowed' : ''
                    }`}
                  >
                    {uploading ? 'Uploading...' : 'Upload'}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // Render the app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
